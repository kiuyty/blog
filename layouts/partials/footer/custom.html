{{- /* æ·»åŠ Live2Dçœ‹æ¿å¨˜ - SDKé€‚é…ç‰ˆ */ -}}
<script>
  (function() {
    const cdnPath = "https://cdn.jsdelivr.net/gh/kiuyty/live2d@main";
    
    // å®šä¹‰æ¨¡å‹æ‰€åœ¨çš„ç›®å½•è·¯å¾„ï¼ˆå…³é”®ä¿®æ­£ï¼‰
    const modelDirPath = cdnPath + "/Resources/model/lafei/";
    
    const config = {
      path: {
        homePath: "/",
        modelPath: cdnPath + "/Resources/",
        cssPath: cdnPath + "/css/waifu.css",
        tipsJsonPath: cdnPath + "/Resources/waifu-tips.json",
        tipsJsPath: cdnPath + "/js/waifu-tips.js",
        live2dCorePath: cdnPath + "/Core/live2dcubismcore.js",
        live2dSdkPath: cdnPath + "/js/live2d-sdk.js"
      },
      tools: ["hitokoto", "asteroids", "express", "switch-model", "switch-texture", "photo", "info", "quit"],
      drag: { enable: true, direction: ["x", "y"] },
      switchType: "order"
    };

    console.log('Live2D SDKé€‚é…ç‰ˆå¯åŠ¨', cdnPath);
    console.log('æ¨¡å‹ç›®å½•è·¯å¾„:', modelDirPath); // ç°åœ¨è¾“å‡ºçš„æ˜¯ç›®å½•

    if (screen.width < 768) {
      console.log('ç§»åŠ¨ç«¯ä¸æ˜¾ç¤º');
      return;
    }

    Promise.all([
      loadCSS(config.path.cssPath),
      loadScript(config.path.live2dCorePath),
      loadScript(config.path.live2dSdkPath),
      loadScript(config.path.tipsJsPath).then(() => {
        console.log('waifu-tips.js å·²åŠ è½½');
        return new Promise(resolve => setTimeout(resolve, 500));
      })
    ]).then(() => {
      console.log('æ‰€æœ‰èµ„æºå°±ç»ª...');
      
      return fetch(config.path.modelPath + 'model_list.json')
        .then(r => r.json())
        .then(modelData => {
          console.log('æ¨¡å‹æ•°æ®å·²åŠ è½½:', modelData);
          
          // è°ƒç”¨ initWidget
          if (typeof window.initWidget === 'function') {
            console.log('è°ƒç”¨ initWidget');
            window.initWidget({
              waifuPath: config.path.tipsJsonPath,
              cdnPath: config.path.modelPath, // æ³¨æ„ï¼šè¿™é‡Œä»ç„¶æ˜¯ Resources ç›®å½•
              tools: config.tools,
              dragEnable: config.drag.enable,
              dragDirection: config.drag.direction,
              switchType: config.switchType,
              modelList: { models: modelData }
            });
          }
          
          // æŒ‰ç…§ SDK æœŸæœ›çš„æ–¹å¼åŠ è½½æ¨¡å‹
          setTimeout(() => {
            if (window.live2d) {
              console.log('æŒ‰ç…§ SDK è§„èŒƒåŠ è½½æ¨¡å‹ï¼Œç›®å½•:', modelDirPath);
              
              // é‡è¦ï¼šè¿™é‡Œä¼ å…¥çš„æ˜¯æ¨¡å‹æ‰€åœ¨çš„ç›®å½•è·¯å¾„
              // SDK ä¼šè‡ªåŠ¨å¯»æ‰¾ç›®å½•ä¸‹çš„ .model3.json æ–‡ä»¶
              window.live2d.loadModel(modelDirPath);
            }
          }, 1500);
          
          console.log('ğŸ‰ åˆå§‹åŒ–å®Œæˆ');
        });
    }).catch(e => console.error('åˆå§‹åŒ–å¤±è´¥:', e));

    function loadCSS(url) {
      return new Promise((resolve, reject) => {
        const link = document.createElement('link');
        link.rel = 'stylesheet';
        link.href = url;
        link.onload = () => resolve(url);
        link.onerror = reject;
        document.head.appendChild(link);
      });
    }

    function loadScript(url) {
      return new Promise((resolve, reject) => {
        const script = document.createElement('script');
        script.src = url;
        script.onload = () => resolve(url);
        script.onerror = reject;
        document.head.appendChild(script);
      });
    }
  })();
</script>

<style>
  #waifu { right: 0; bottom: 0; left: auto; }
  #waifu-toggle { right: 5px; left: auto; }
</style>
